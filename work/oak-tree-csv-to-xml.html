<!doctype html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <title>Oak Tree | CSV to XML Parser</title>

   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

  </head>

  <body>

    Path: <input id="pathTxt" style="width:450px" type="text" name="pathTxt" value="Oak Tree Export - Sheet1.csv">
    <br/><br/>
     <button type="button" onclick="makeXML()">Generate</button>
     <br/><br/>
    <textarea id="txtoutput" style='width:70%; height:500px'></textarea>
    <br/><br/>
    <a href="http://www.freeformatter.com/xml-formatter.html" target="_blank">XML Formatter</a>

  </body>

  <script type="text/javascript">

    var clearXML = function(){
      //Clear text area of anything previous
      document.getElementById("txtoutput").value='';
    }



    var makeXML = function(){

    var manifestType = 'specimens';
    var objectType = 'specimen';

    var config = $.parseHTML( '<xxx><config><!-- ======== --><!-- SETTINGS --><!-- ======== --><settings><setting id="example_setting" value="example_value" /></settings><!-- ======== --><!-- LANGUAGE --><!-- ======== --><component><'+manifestType+'></'+manifestType+'></component></config></xxx>');

    //load html to parse
    var indexPath = document.getElementById("pathTxt").value;

    $.get(indexPath+'').success( function(data) {

        var components = data.split('Component # 813\n Mountains\n \n XID: ');

        components.shift();

        components.forEach(function( c ) {


            var lines = c.split('\n');

            var commonEnglish = (lines[0].split('","')[0]).trim();
            var scientific = (lines[1]).trim();
            var descripEnglish = (lines[3].split('","')[0]).trim();
            var commonSpanish = (lines[3].split('","')[1]).trim();
            var descripSpanish = lines[6].substring(0, lines[6].length - 1).trim();

            var spacers = Array(commonEnglish.length+1).join("=");
            var s = $.parseHTML( '<!-- '+spacers+' --><!-- '+commonEnglish+' --><!-- '+spacers+' --><'+objectType+'></'+objectType+'>' );

            //set manifest object attributes
            var objectId = prompt("ID for: "+commonEnglish, "");
            // var objectId = commonEnglish;
            $(s).attr('id', objectId);
            $(s).attr('img', "img/"+objectId+".png");

            var cNode = textNode('common', commonEnglish, commonSpanish);
            var sNode = textNode('scientific', scientific);
            var dNode = textNode('description', descripEnglish, descripSpanish);

            $(s).append(cNode);
            $(s).append(sNode);
            $(s).append(dNode);

            //add slide config
            $(config).find(manifestType).append(s);


        });

        //Send to text area
        document.getElementById("txtoutput").value = $(config).html();

    });

  }

  function textNode(id, english, spanish){


    if(typeof(spanish)==='undefined') {

      //No translations
      return $.parseHTML( '<text id="'+id+'">'+english+'</text>' );

    } else {

      //Bilingual
      return $.parseHTML( '<text id="'+id+'"><en>'+english+'</en><es>'+spanish+'</es></text>' );

    }

  }

  //auto on refresh
  makeXML();

  </script>

</html>